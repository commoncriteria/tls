<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../transforms/pp2html.xsl"?>

<!-- <Package name="TLS" repo-name="tls" pp-version="1.1"  -->
<Package name="TLS"
    xmlns="https://niap-ccevs.org/cc/v1"
    xmlns:sec="https://niap-ccevs.org/cc/v1/section"
    xmlns:h="http://www.w3.org/1999/xhtml"
    >
  <!-- <inline-comment color='green'> Hello World TLS </inline-comment> -->
  <!-- <inline-comment color='blue' linebreak='yes'> Hello World TLS </inline-comment> -->
  <PPReference>
    <ReferenceTable>
      <PPTitle>Functional Package for Transport Layer Security (TLS)</PPTitle>
      <PPVersion>2.0-draft</PPVersion>
      <PPAuthor>National Information Assurance Partnership</PPAuthor>
      <PPPubDate>2022-08-24</PPPubDate>
      <Keywords>TLS</Keywords>
    </ReferenceTable>
  </PPReference>

  <RevisionHistory>
    <entry>
      <version>1.0</version>
      <date>2018-12-17</date>
      <subject>First publication</subject>
    </entry>
    <entry>
      <version>1.1</version>
      <date>2019-03-01</date>
      <subject>Clarifications regarding override for invalid certificates,
      renegotiation_info extension, DTLS versions, and named Diffie-Hellman groups in DTLS
      contexts</subject>
    </entry>
     <entry>
      <version>2.0</version>
      <date>2022-08-24</date>
      <subject>Added audit events, added TLS 1.3 support, deprecated TLS 1.0 and 1.1, updated algorithms/ciphersuites in accordance with CNSA suite RFC and to consider PSK, restructured SFRs for clarity</subject>
    </entry>

	  
  </RevisionHistory>
	
  <!-- PP-style preferences   -->
  <pp-preferences>
<!--        <pp-pref name="display-audit-with-sfrs">0</pp-pref> -->
   	<audit-events-in-sfrs/>
  </pp-preferences>

  <sec:Introduction>
    <sec:Overview>
      <h:p>      
	  Transport Layer Security (TLS) and the closely-related Datagram TLS (DTLS) are
    cryptographic protocols designed to provide communications security over IP networks.
    Several versions of the protocol are in widespread use in software that provides functionality
    such as web browsing, email, instant messaging, and voice-over-IP (VoIP).
    Major websites use TLS to protect communications to and from their servers.
    TLS is also used to protect communications between
    hosts and network infrastructure devices for administration.
    The underlying platform, such as an operating system, often provides the
    actual TLS implementation.
    The primary goal of the TLS protocol is to
    provide confidentiality and integrity of data transmitted
    between two communicating endpoints, as well as authentication of at least
    the server endpoint.
    </h:p><h:p>
	  TLS supports many different methods for exchanging keys, encrypting data,
	  and authenticating message integrity. These methods are dynamically negotiated
    between the client and server when the TLS connection is established.
    As a result, evaluating the implementation of both endpoints is typically
    necessary to provide assurance for the operating environment.
    </h:p><h:p>
	  This "Functional Package for Transport Layer Security" (short name "TLS-PKG")
    defines functional requirements for the implementation of the TLS
    and DTLS protocols. The requirements are
    intended to improve the security of products by enabling their evaluation.
  </h:p>
    </sec:Overview>
    <tech-terms>
      <term abbr="AES" full="Advanced Encryption Standard"/>
      <term abbr="CA" full="Certificate Authority">
	      Issuer of digital certificates.
      </term>
      <term abbr="CBC" full="Cipher Block Chaining"/>
      <term abbr="CN" full="Common Name"/>
      <term abbr="DHE" full="Diffie-Hellman Ephemeral"/>
      <term abbr="DN" full="Distinguished Name"/>
      <term abbr="DNS" full="Domain Name Server"/>
      <term abbr="DTLS" full="Datagram Transport Layer Security">
	      Cryptographic network protocol, based on TLS, which provides
              communications security for datagram protocols.
	    </term>
      <term abbr="EAP" full="Extensible Authentication Protocol"/>
      <term abbr="ECDHE" full="Elliptic Curve Diffie-Hellman Ephemeral"/>
      <term abbr="ECDSA" full="Elliptic Curve Digital Signature Algorithm"/>
      <term abbr="GCM" full="Galois/Counter Mode"/>
      <term abbr="HTTP" full="Hypertext Transfer Protocol"/>
      <term abbr="IETF" full="Internet Engineering Task Force"/>
      <term abbr="IP" full="Internet Protocol"/>
      <!-- <term abbr="LDAP" full="Lightweight Directory Access Protocol"/>  -->
      <term abbr="NIST" full="National Institute of Standards and Technology"/>
      <term abbr="RFC" full="Request for Comment (IETF)"/>
      <term abbr="RSA" full="Rivest Shamir Adelman"/>
      <term abbr="SAN" full="Subject Alternative Name"/>
      <term abbr="SCSV" full="Signaling ciphersuite Value"/>
      <term abbr="SHA" full="Secure Hash Algorithm"/>
      <!-- <term abbr="SIP" full="Session Initiation Protocol"/> -->
      <term abbr="TCP" full="Transmission Control Protocol"/>
      <term abbr="TLS" full="Transport Layer Security">
        Cryptographic network protocol for providing communications
        security over a TCP/IP network.
      </term>
      <term abbr="UDP" full="User Datagram Protocol"/>
      <term abbr="URI" full="Uniform Resource Identifier"/>
      <term abbr="URL" full="Uniform Resource Locator"/>
    </tech-terms>

    <sec:Compliant_Targets_of_Evaluation>
      <h:p>
      The Target of Evaluation
      (TOE) in this Package is a product which acts as a (D)TLS client, a (D)TLS server, or both.
      This Package describes the security functionality of TLS and DTLS in terms of   <xref g="CC" />. 
      </h:p><h:p>
      The contents of this Package must be appropriately
      combined with a PP or PP-Module.
      When this Package is instantiated by a PP or PP-Module, the Package must
      include selection-based requirements in accordance with the
      selections or assignments indicated in the PP or PP-Module.  These may be expanded by the
      the ST author.
      </h:p><h:p>
      The PP or PP-Module which instantiates this Package must typically include
      the following components in order to satisfy dependencies of this Package. It is the responsibility
      of the PP or PP-Module author who instantiates this Package to ensure that dependence
      on these components is satisfied:<h:br/>
      <componentsneeded>
        <componentneeded>
          <componentid>FCS_CKM.1</componentid>
          <notes>To support TLS ciphersuites that use RSA, DHE or ECDHE for key exchange, the PP or PP-Module must
            include FCS_CKM.1 and specify the corresponding key generation algorithm.</notes>
        </componentneeded>
      <componentneeded>
        <componentid>FCS_CKM.2</componentid>
        <notes>To support TLS ciphersuites that use RSA, DHE or ECDHE for key exchange, the PP or PP-Module must
          include FCS_CKM.2 and specify the corresponding algorithm.</notes>
      </componentneeded>
      <componentneeded>
        <componentid>FCS_COP.1</componentid>
        <notes>To support TLS ciphersuites that use AES for encryption and decryption, the PP or PP-Module
          must include FCS_COP.1 (iterating as needed) and specify AES with corresponding key sizes and modes. To
          support TLS ciphersuites that use SHA for hashing, the PP or PP-Module must include FCS_COP.1
          (iterating as needed) and specify SHA with corresponding digest sizes.
        </notes>
      </componentneeded>
      <!-- The components in the PP or PP-Module that need this SFR should require it;
      it is not _directly_ depended upon by this Package.-->
      <componentneeded>
        <componentid>FCS_RBG_EXT.1</componentid>
        <notes>To support random bit generation needed for the TLS handshake,
          the PP or PP-Module must include FCS_RBG_EXT.1.</notes>
      </componentneeded>
      <componentneeded>
        <componentid>FIA_X509_EXT.1</componentid>
        <notes>
          To support validation of certificates needed during TLS connection setup,
          the PP or PP-Module must include FIA_X509_EXT.1.
        </notes>
      </componentneeded>
      <componentneeded>
        <componentid>FIA_X509_EXT.2</componentid>
        <notes>To support the use of X509 certificates for authentication in TLS connection setup,
          the PP or PP-Module must include FIA_X509_EXT.2.
          </notes>
      </componentneeded>
    </componentsneeded>
    </h:p><h:p>
      An ST must identify the applicable version of the PP or
      PP-Module and this Package in its conformance claims.
      </h:p>
      
    </sec:Compliant_Targets_of_Evaluation>

  </sec:Introduction>
  <sec:Conformance_Claims>
    <cclaims>
      <cclaim name="Conformance Statement">
        <description>
	  <h:p>
	    This Package serves to provide Protection Profiles with additional 
          SFRs and associated Evaluation Activities specific to TLS clients and servers.  
          </h:p><h:p>
          This Package conforms to Common Criteria
          <xref g="CC" /> for Information Technology Security Evaluation, Version 3.1,
          Revision 5. It is CC Part 2 extended conformant.
          </h:p><h:p>
          In accordance with CC Part 1, dependencies are not included when they are addressed
          by other SFRs. The evaluation activities provide adequate proof that any dependencies are
          also satisfied.</h:p></description>
      </cclaim>
    </cclaims>
  </sec:Conformance_Claims>
  
  <sec:Security_Functional_Requirements>
 <!--   This chapter describes the security requirements
    to be fulfilled by the product. Those requirements comprise functional components from Part 2 of
    <xref to="bibCC" />. The following notations are used:
    <h:ul>
      <h:li>
        <h:b>Selection</h:b> (denoted by
        <h:i>italicized text</h:i>): is used to select one or more options provided by the [CC] in stating
        a requirement.</h:li>
      <h:li>
        <h:b>Assignment</h:b> operation (denoted by
        <h:span class="assignable-content">italicized text</h:span>): is used to assign a specific 
        value to an unspecified parameter, such
        as the length of a password. Showing the value in square brackets indicates assignment.</h:li>
      <h:li>
        <h:b>Iteration</h:b> operation: are identified with a number inside parentheses (e.g. "(1)").</h:li>
    </h:ul> 
    <section title="Security Functional Requirements" id="SFRs">The Security Functional Requirements
      included in this section are derived from Part 2 of the Common Criteria for Information
      Technology Security Evaluation, Version 3.1, Revision 5, with additional extended functional
      components.-->
	  
 <sec:Auditable_Events_for_Mandatory_SFRs>
   <h:p>
     The auditable events specified in this Functional Package are included in a Security Target 
     if the incorporating PP or PP-Module supports audit event reporting through FAU_GEN.1 and all other criteria in the incorporating
     PP or PP-Module are met.
   </h:p>
   <audit-table table="mandatory" id="t-audit-mandatory"/>

 </sec:Auditable_Events_for_Mandatory_SFRs>
      <section title="Cryptographic Support (FCS)" id="fcs">
        <f-component cc-id="fcs_tls_ext.1" name="TLS Protocol">
          <f-element id="fel-tls-usage">
			<title>The TSF shall implement
        <selectables linebreak="yes">
          <selectable id="tlsc_impl">TLS as a client</selectable>
          <selectable id="tlss_impl">TLS as a server</selectable>
          <selectable id="dtlsc_impl">DTLS as a client</selectable>
          <selectable id="dtlss_impl">DTLS as a server</selectable></selectables>.
        </title>
        <note role="application">
              If <h:i>TLS as a client</h:i> is selected, then the
              ST must include the requirements from FCS_TLSC_EXT.1.
              <h:br/>
              If <h:i>TLS as a server</h:i> is selected, then the
              ST must include the requirements from FCS_TLSS_EXT.1.
              <h:br/><h:br/>
              If <h:i>DTLS as a client</h:i> is selected, then the
              ST must include the requirements from FCS_DTLSC_EXT.1.
              <h:br/>
              If <h:i>DTLS as a server</h:i> is selected, then the
              ST must include the requirements from FCS_DTLSS_EXT.1.
            </note>
            <aactivity>
              <TSS>
                The evaluator shall examine the TSS to verify that the TLS and DTLS claims are consistent with those selected in the SFR.<h:p/>
              </TSS>
	      <Guidance>
		The evaluator shall ensure that the selections indicated in the ST are
		consistent with selections in the dependent components.<h:p/>
	      </Guidance>
              <Tests>
                
                There are no test activities for this SFR; the following information is provided as an overview of the expected functionality and test environment for all subsequent SFRs.
                <h:p/>
                <figure entity="images/figure1.png" title="TLS Hello" id="Hello"/>
                <h:p/>
                The chart above provides an overview of the TLS hello messages, 
                the content and protections, and the establishment of cryptographic keys in support of the protections.
                <h:ul>
                  <h:li>Blue text indicates a message or content unique to TLS 1.2.</h:li> 
                  <h:li>Green text indicates uniqueness to TLS 1.3.</h:li> 
                  <h:li>Black text indicates features common to both TLS 1.2 and TLS 1.3.</h:li> 
                  <h:li>Bold text indicates mandatory features.</h:li>
                  <h:li>Italics emphasizes optional features. </h:li>
                  <h:li>A shaded text box indicates that the message is encrypted for TLS 1.2 (blue), TLS 1.3 (green) or both TLS 1.2 and TLS 1.3 (grey).</h:li> 
                  <h:li>An outlined text box indicates that the content in the message is signed, and/or provides authentication of the handshake to that point.</h:li>
                </h:ul>
                <h:p/>
                <h:b>Test Environment:</h:b>
                <h:p/>
                Tests for TLS 1.2 and TLS 1.3 include examination of the handshake messages and behavior of the TSF when presented with unexpected or invalid messages. 
                For TLS 1.2 and below, previous versions of this Functional Package only required visibility of network traffic and the ability to modify a valid handshake message sent to the TSF.
                <h:p/>
                <figure entity="images/figure2.png" title="Test environment for TLS 1.2 using network traffic visibility and control tools" id="Figure2"/>
                <h:p/>
                TLS 1.3 introduces the encryption of handshake messages subsequent to the server hello exchange which prevents visibility and control using midpoint capabilities. 
                To achieve equivalent validation of TLS 1.3 requires the ability to modify the traffic underlying the encryption applied after the server hello message. 
                This can be achieved by introducing additional control of the messages sent, and visibility of messages received by the test TLS client, 
                when validating TLS server functionality or test server, when validating TLS client functionality.
                <h:p/>
                <figure entity="images/figure3.png" title="Test environment for TLS 1.3 using custom endpoint capabilities for visibility and control" id="Figure3"/>
                <h:p/>
                Typically, a compliant TLS 1.3 library modified to provide visibility and control of the handshake messages prior to encryption suffices for all tests. 
                Such modification will require the test client and/or server to be validated. 
                <h:p/>
                Since validations of products supporting only TLS 1.2 are still expected under this Package, 
                the test environment for TLS 1.2-only validations may include network sniffers and man-in-the-middle products that do not require such modifications to a compliant TLS 1.2 library. 
                For consistency, a compliant TLS client (or TLS server) together with the network sniffers and man-in-the-middle capabilities 
                will also be referred to as a test TLS client (or test TLS server, respectively) in the following evaluation activities.
                <h:p/>
                <figure entity="images/figure4.png" title="Combined test environment for TLS 1.2 and TLS 1.3 using both network tools and custom endpoint capabilities" id="Figure4"/>
                 
              </Tests>
            </aactivity>
          </f-element>
	  <audit-event />
        </f-component>

      
        
        
        <f-component cc-id="fcs_tlsc_ext.2" name="TLS Client Support for Mutual Authentication" status="sel-based">
		  <depends on-sel="tlsc_mutual_auth"/>
          <f-element id="fel-mut-auth-certs">
            <title>The TSF shall support mutual authentication using X.509v3 certificates during the handshake and <selectables>
              <selectable>in support of post-handshake authentication requests</selectable>
              <selectable>at no other time</selectable></selectables>, in accordance with <selectables> 
              <selectable>RFC 5246, section 7.4.4</selectable>
              <selectable>RFC 8446, section 4.3.2</selectable></selectables>.</title>
            <note role="application">
              Clients that support TLS 1.3 and post-handshake authentication claim ‘in support of post-handshake authentication requests’ in the first selection. 
              The ‘at no other time’ selection is claimed for clients only supporting TLS 1.2 or for TLS 1.3 clients that do not support post-handshake authentication.  
              <h:p/>
              The certificate request sent by the server specifies the signature algorithms and certification authorities supported by the server. 
              If the client does not possess a matching certificate, it sends an empty certificate message. 
              The structure of the certificate request message is changed in TLS 1.3 to use the signature_algorithm, signature_algorithms_cert, and certificate_authorities extensions, 
              and RFC 8446 allows for TLS 1.2 implementations to use the new message structure. 
              The "RFC 8446, section 4.3.2" option is claimed in the second selection if TLS 1.3 is supported or if the RFC 8446 method is supported for TLS 1.2 servers. 
              The "RFC 5246, section 7.4.4" option is claimed if the RFC 5246 method is supported for interoperability with TLS 1.2 servers that do not adopt the RFC 8446 method. 
              When mutual authentication is supported, at least one of these methods must be claimed, per the selection.
              <h:p/>
              This SFR is claimed if "mutual authentication" is selected in FCS_TLSC_EXT.1.1.
            </note>
            <aactivity>
              <TSS>
                The evaluator shall ensure that the TSS description required per <no-link>FIA_X509_EXT.2.1</no-link> includes the use of client-side certificates for TLS mutual authentication. 
                The evaluator shall also ensure that the TSS describes any factors beyond configuration that are necessary in order for the client to engage in mutual authentication using X.509v3 certificates.
                <h:p/>
	      </TSS>
              <Guidance>
                The evaluator shall ensure that the operational guidance includes any instructions necessary to configure the TOE to perform mutual authentication. 
                The evaluator also shall verify that the operational guidance required per <no-link>FIA_X509_EXT.2.1</no-link> includes instructions for configuring the client-side certificates for TLS mutual authentication.
                <h:p/>
	      </Guidance>
              <Tests>
                For each supported TLS version, the evaluator shall perform the following tests:
       <testlist>
         <test>The evaluator shall establish a TLS connection from the TSF to a test TLS server that negotiates the tested version 
           and which is not configured for mutual authentication (i.e., does not send a Server’s Certificate Request (type 13) message). 
           The evaluator observes negotiation of a TLS channel and confirms that the TOE did not send a Client’s Certificate message (type 11) during handshake.<h:p/></test>
         <test>The evaluator shall establish a connection to a test TLS server with a shared trusted root that is configured for mutual authentication 
           (i.e., it sends a Server’s Certificate Request (type 13) message). 
           The evaluator observes negotiation of a TLS channel and confirms that the TOE responds with a non-empty Client’s Certificate message (type 11) and Certificate Verify (type 15) message.<h:p/></test>
         <test>[conditional] If the TSF supports post-handshake authentication, 
           the evaluator shall establish a pre-shared key between the TSF and a test TLS 1.3 server. 
           The evaluator shall initiate a TLS session using the pre-shared key and confirm the TSF and test TLS 1.3 server successfully complete the TLS handshake and both support post-handshake authentication. 
           After the session is successfully established, the evaluator shall initiate a certificate request message from the test TLS 1.3 server. 
           The evaluator shall observe that the TSF receives that authentication request 
           and shall take necessary actions, in accordance with the operational guidance, to complete the authentication request. 
           The evaluator shall confirm that the test TLS 1.3 server receives certificate and certificate verification messages from the TSF over the channel that authenticates the client.
           <h:p/>
           <h:b>Note:</h:b> TLS 1.3 certificate requests from the test server and client certificate and certificate verify messages are encrypted. 
           The evaluator confirms that the TSF sends the appropriate messages by examining the messages received at the test TLS 1.3 server and by inspecting any relevant server logs. 
           The evaluator may also take advantage of the calling application to demonstrate that the TOE receives data configured at the test TLS server. 
         <h:p/></test>
       </testlist>
	      </Tests>
            </aactivity>
          </f-element>
	  <audit-event/>
        </f-component>
	      
  <f-component cc-id="fcs_dtlsc_ext.1" name="DTLS Client Protocol" status="sel-based">
    <depends on-sel="dtlsc_impl"/>
    <f-element id="fel-dtlsc-impl">
      <title>The product shall implement DTLS 1.2 (RFC 6347) and
      <selectables>
        <selectable>DTLS 1.0 (RFC 4347)</selectable>
        <selectable exclusive="yes">no earlier DTLS versions</selectable>
      </selectables> as a client that supports the ciphersuites
    <selectables linebreak="yes">
      <selectable>TLS_RSA_WITH_AES_128_CBC_SHA as defined in RFC 5246</selectable>
      <selectable>TLS_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5246</selectable>
      <selectable>TLS_RSA_WITH_AES_256_CBC_SHA256 as defined in RFC 5246</selectable>
      <selectable>TLS_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5288</selectable>
      <selectable id="drsadhe1">TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5246</selectable>
      <selectable id="drsadhe2">TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 as defined in RFC 5246</selectable>
      <selectable id="drsadhe3">TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5288</selectable>
      <selectable id="decdhe1">TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</selectable>
      <selectable id="decdhe2">TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</selectable>
      <selectable id="decdhe3">TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</selectable>
      <selectable id="decdhe4">TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</selectable>
      <selectable id="decdhe5">TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</selectable>
      <selectable id="decdhe6">TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</selectable>
      <selectable id="decdhe7">TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</selectable>
      <selectable id="decdhe8">TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</selectable>
      </selectables>
      and also supports functionality for 
      <selectables linebreak="yes">
        <selectable id="dtlsc_mutual_auth">mutual authentication</selectable>
        <selectable exclusive="yes">none</selectable>
      </selectables>.
      </title>
      <note role="application">
      If any ECDHE or DHE ciphersuites are selected, then
      FCS_TLSC_EXT.5 is required.
      <h:br/><h:br/>
      If <h:i>mutual authentication</h:i> is selected, then the ST must additionally include 
      the requirements from FCS_DTLSC_EXT.2.
      If the TOE implements
      mutual authentication, this selection must be made.
      <h:br/><h:br/>
      Differences between DTLS 1.2 and TLS 1.2 are outlined in RFC 6347; otherwise the
      protocols are the same.
      All application notes listed for <xref to="fel-client"/> that are relevant
      to DTLS apply to this requirement.
    </note>
      <aactivity level="element">
	<Tests>
        The evaluator shall perform the evaluation activities listed for <xref to="fel-client"/>,
        but ensuring that DTLS (and not TLS) is used in each evaluation activity.
        <h:br/><h:br/>
        For tests which involve version numbers, note that in DTLS the on-the-wire representation
        is the 1's complement of the corresponding textual DTLS version numbers. This is described in
        Section 4.1 of RFC 6347 and RFC 4347.  For example, DTLS 1.0 is represented by the bytes 0xfe 0xff,
        while the undefined DTLS 1.4 would be represented by the bytes 0xfe 0xfb.
	</Tests>
      </aactivity>
    </f-element>

    <f-element id="fel-dtlsc-match-id">
      <title> The product shall verify that the presented identifier matches the reference
        identifier according to RFC 6125. </title>
        <note role="application">
          All application notes listed for <xref to="fel-present-identifier" /> that are relevant
          to DTLS apply to this requirement.
        </note>
      <aactivity level="element">
      <Tests>
	The evaluator shall perform the evaluation activities listed for
	<xref to="fel-present-identifier"/>.
      </Tests>
      </aactivity>
    </f-element>

    <f-element id="fel-dtlsc-bad-cert">
      <title>The product shall not establish a trusted channel if the
        server certificate is invalid
        <selectables>
        <selectable exclusive="yes">with no exceptions</selectable>
        <selectable>except when override is authorized</selectable>
      </selectables>.
      </title>
      <note role="application">
        All application notes listed for <xref to="fel-server-cert" /> that are relevant
        to DTLS apply to this requirement.
      </note>
      <aactivity>
        <Tests>
          The evaluator shall perform the evaluation activities listed for <xref to="fel-server-cert"/>.
	</Tests>
      </aactivity>
    </f-element>
    <f-element id="fel-dtlsc-fail">
    <title>The product shall
    <selectables onlyone="yes">
      <selectable>terminate the DTLS session</selectable>
      <selectable>silently discard the record</selectable>
    </selectables>
    if a message received contains an invalid MAC or if decryption fails in the case of GCM and other
    AEAD ciphersuites.
    </title>
    <aactivity level="element">
      <TSS>
      The evaluator shall verify that the TSS describes the actions that take place if a message
      received from the DTLS Server fails the MAC integrity check.
      </TSS>
      <Tests>
      The evaluator shall establish a connection using a server. The evaluator will then modify
      at least one byte in a record message, and verify that the client discards the record or
      terminates the DTLS session.
      </Tests>
    </aactivity>
  </f-element>
 	<audit-event type="optional">
		<audit-event-descr>Failure of the certificate validity check</audit-event-descr>
		<audit-event-info>Issuer Name and Subject Name of certificate.</audit-event-info>
	</audit-event> 
  </f-component>

  <f-component cc-id="fcs_dtlsc_ext.2" name="DTLS Client Support for Mutual Authentication" status="sel-based">
    <depends on-sel="dtlsc_mutual_auth"/>
          <f-element id="fel-dtlsc-mut-auth">
            <title>
              The product shall support mutual authentication using X.509v3 certificates.
            </title>
            <note role="application">
              All application notes listed for <xref to="fel-mut-auth-certs" /> that are relevant
              to DTLS apply to this requirement.
      </note>
      <aactivity>
	<Tests>
          The evaluator shall perform the evaluation activities listed for <xref to="fel-mut-auth-certs" />.
	</Tests>
      </aactivity>
    </f-element>
	  <audit-event/>
  </f-component>

  <f-component cc-id="fcs_dtlss_ext.1" name="DTLS Server Protocol" status="sel-based">
    <depends on-sel="dtlss_impl"/>
    <f-element id="fel-dtlss-impl">
      <title>The product shall implement DTLS 1.2 (RFC 6347) and
      <selectables>
        <selectable>DTLS 1.0 (RFC 4347)</selectable>
        <selectable exclusive="yes">no earlier DTLS versions</selectable>
      </selectables>
        as a server that supports the ciphersuites
        <selectables linebreak="yes">
          <selectable>TLS_RSA_WITH_AES_128_CBC_SHA as defined in RFC 5246</selectable>
          <selectable>TLS_RSA_WITH_AES_256_CBC_SHA as defined in RFC 5246</selectable>
          <selectable>TLS_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5246</selectable>
          <selectable>TLS_RSA_WITH_AES_256_CBC_SHA256 as defined in RFC 5246</selectable>
          <selectable>TLS_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5288</selectable>
          <selectable>TLS_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5288</selectable>
          <selectable>TLS_DHE_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5246</selectable>
          <selectable>TLS_DHE_RSA_WITH_AES_256_CBC_SHA256 as defined in RFC 5246</selectable>
          <selectable>TLS_DHE_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5288</selectable>
          <selectable>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5288</selectable>
          <selectable>TLS_ECDHE_ECDSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</selectable>
          <selectable>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</selectable>
          <selectable>TLS_ECDHE_ECDSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</selectable>
          <selectable>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</selectable>
          <selectable>TLS_ECDHE_RSA_WITH_AES_128_CBC_SHA256 as defined in RFC 5289</selectable>
          <selectable>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256 as defined in RFC 5289</selectable>
          <selectable>TLS_ECDHE_RSA_WITH_AES_256_CBC_SHA384 as defined in RFC 5289</selectable>
          <selectable>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384 as defined in RFC 5289</selectable>
        </selectables> and no other ciphersuites,
        and also supports functionality for
        <selectables linebreak="yes">
          <selectable id="dtlss_mutual_auth">mutual authentication</selectable>
          <selectable exclusive="yes">none</selectable>
      </selectables>.
      </title>
      <note role="application">
      If <h:i>mutual authentication</h:i> is selected, then the ST must additionally include
      the requirements from FCS_DTLSS_EXT.2.  If the TOE implements
      mutual authentication, this selection must be made.
      <h:br/><h:br/>
      All application notes listed for <xref to="fel-tlss-impl" /> that are relevant
      to DTLS apply to this requirement.
      </note>
      <aactivity level="element">
	<Tests>
        The evaluator shall perform the evaluation activities listed for <xref to="fel-tlss-impl"/>,
        but ensuring that DTLS (and not TLS) is used in each stage of the evaluation activities.
        <h:br/><h:br/>
        For tests which involve version numbers, note that in DTLS the on-the-wire representation
        is the 1's complement of the corresponding textual DTLS version numbers. This is described in
        Section 4.1 of RFC 6347 and RFC 4347.  For example, DTLS 1.0 is represented by the bytes 0xfe 0xff,
        while the undefined DTLS 1.4 would be represented by the bytes 0xfe 0xfb.
	</Tests>
      </aactivity>
    </f-element>
    <f-element id="fel-dtlss-deny-version">
      <title>The product shall deny connections from clients requesting
        <assignable>list of DTLS protocol versions</assignable>.
      </title>
      <note role="application">Any specific DTLS version
        not selected in <xref to="fel-dtlss-impl"/> should be assigned here.
        This version of the FP does not require the server to deny DTLS 1.0, and if the TOE
        supports DTLS 1.0 then "none" can be assigned. In a future version of this FP,
        DTLS 1.0 will be required to be denied.
      </note>
      <aactivity level="element">
        The following evaluation activities shall be conducted unless "none" is assigned.
        <h:br/><h:br/>
        <TSS>
        The evaluator shall verify that the TSS contains a
        description of the denial of old DTLS versions
        consistent relative to selections in <xref to="fel-dtlss-deny-version" />.
	</TSS>
        <Guidance>
        The evaluator shall verify that the operational guidance includes any configuration
        necessary to meet this requirement.
	</Guidance>
        <Tests>
        <testlist>
          <test>
            The evaluator shall send a Client Hello requesting a
            connection with each version of DTLS specified in the selection
            and verify that the server denies the connection.
          <h:p/></test>
        </testlist>
	</Tests>
      </aactivity>
    </f-element>

    <f-element id="fel-dtlss-fail-validation">
      <title>
        The product shall not proceed with a connection handshake attempt if the DTLS Client fails validation.
      </title>
      <note role="application">
        The process to validate the IP address of a DTLS client is specified in section 4.2.1 of RFC 6347 (DTLS 1.2) and
        RFC 4347 (DTLS 1.0). The server validates the DTLS client during Connection Establishment (Handshaking) and prior
        to sending a Server Hello message. After receiving a ClientHello, the DTLS Server sends a
        HelloVerifyRequest along with a cookie. The cookie is a signed message using a keyed hash function. The DTLS
        Client then sends another ClientHello with the cookie attached. If the DTLS
        server successfully verifies the signed cookie, the Client is not using a spoofed IP address.
      </note>
      <aactivity level="element">
        <TSS>
        The evaluator shall verify that the TSS describes how the DTLS Client IP address is validated prior to
        issuing a ServerHello message.
	</TSS>
        <Tests>
        Modify at least one byte in the cookie from the Server's HelloVerifyRequest message, and verify that the
        Server rejects the Client's handshake message.
	</Tests>
      </aactivity>
    </f-element>
    <f-element id="fel-dtlss-rsa-keysize">
      <title>The product shall perform key establishment for DTLS using
        <selectables>
          <selectable>RSA with size
            <selectables>
              <selectable>2048 bits</selectable>
              <selectable>3072 bits</selectable>
              <selectable>4096 bits</selectable>
              <selectable exclusive="yes">no other sizes</selectable>
            </selectables>
          </selectable>
          <selectable>Diffie-Hellman parameters with size
            <selectables>
              <selectable>2048 bits</selectable>
              <selectable>3072 bits</selectable>
              <selectable>4096 bits</selectable>
              <selectable>6144 bits</selectable>
              <selectable>8192 bits</selectable>
              <selectable exclusive="yes">no other size</selectable>
            </selectables>
          </selectable>
          <selectable>Diffie-Hellman groups
            <selectables>
              <selectable>ffdhe2048</selectable>
              <selectable>ffdhe3072</selectable>
              <selectable>ffdhe4096</selectable>
              <selectable>ffdhe6144</selectable>
              <selectable>ffdhe8192</selectable>
              <selectable exclusive="yes">no other groups</selectable>
            </selectables>
          </selectable>
          <selectable>ECDHE parameters using elliptic curves
            <selectables>
              <selectable>secp256r1</selectable>
              <selectable>secp384r1</selectable>
              <selectable>secp521r1</selectable>
            </selectables> and no other curves</selectable>
          <selectable exclusive="yes">no other key establishment methods</selectable>
        </selectables>.
      </title>
      <note role="application">
        If the ST lists an RSA ciphersuite in <xref to="fel-dtlss-impl"/>, the ST must include the
        RSA selection in the requirement.
        <h:br/>
        If the ST lists a DHE ciphersuite in <xref to="fel-dtlss-impl"/>, the ST must include either
        the Diffie-Hellman selection for parameters of a certain size,
        or for particular Diffie-Hellman groups.
        <h:br/>
        If the ST lists an ECDHE ciphersuite in <xref to="fel-dtlss-impl"/>, the ST must include the
        NIST curves selection in the requirement.
      </note>
      <aactivity level="element">
      <Tests>
        The evaluator shall perform the evaluation activities listed for <xref to="fel-rsa-size"/>.
      </Tests>
      </aactivity>
    </f-element>
    <f-element id="fel-dtlss-kill-session">
      <title>The product shall
      <selectables onlyone="yes">
        <selectable>terminate the DTLS session</selectable>
        <selectable>silently discard the record</selectable>
      </selectables>
      if a message received contains an invalid MAC or if decryption fails in the case of GCM and other
      AEAD ciphersuites.
      </title>
      <aactivity level="element">
        <TSS>
        The evaluator shall verify that the TSS describes the actions that take place if a message
        received from the DTLS client fails the MAC integrity check.
	</TSS>
        <Tests>
        The evaluator shall establish a connection using a client. The evaluator will then modify
        at least one byte in a record message, and verify that the server discards the record or
        terminates the DTLS session.
	</Tests>
      </aactivity>
    </f-element>
  	<audit-event type="optional">
		<audit-event-descr>Failure of the certificate validity check</audit-event-descr>
		<audit-event-info>Issuer Name and Subject Name of certificate</audit-event-info>
	</audit-event>
  </f-component>

  <f-component cc-id="fcs_dtlss_ext.2" name="DTLS Server Support for Mutual Authentication" status="sel-based">
    <depends on-sel="dtlss_mutual_auth"/>
          <f-element id="fel-dtlss-mut-auth">
            <title>
              The product shall support mutual authentication of DTLS clients using X.509v3 certificates.
            </title>
            <note role="application">
              All application notes listed for <xref to="fel-auth-client-certs" /> that are relevant
              to DTLS apply to this requirement.
      </note>
      <aactivity level="element">
	<Tests>
          The evaluator shall perform the evaluation activities listed for <xref to="fel-auth-client-certs" />.
	</Tests>
      </aactivity>

    </f-element>
    <f-element id="fel-dtlss-bad-cert">
      <title>The product shall not establish a trusted channel
        if the client certificate is invalid.
      </title>
      <note role="application">
        All application notes listed for <xref to="fel-bad-client-cert" /> that are relevant
        to DTLS apply to this requirement.
      </note>
      <aactivity level="element">
	<Tests>
        The evaluator shall perform the evaluation activities listed for <xref to="fel-bad-client-cert" />. 
	</Tests>
      </aactivity>
    </f-element>
    <f-element id="fel-dtlss-bad-name">
      <title>The product shall not establish a trusted channel if
        the Distinguished Name (DN) or Subject Alternative Name (SAN)
        contained in a certificate does not match one of the expected identifiers
        for the client.
      </title>
      <note role="application">
        All application notes listed for <xref to="fel-tlss-match-name" /> that are relevant
        to DTLS apply to this requirement.
      </note>
      <aactivity level="element">
        <Tests>
        The evaluator shall perform the evaluation activities listed for <xref to="fel-tlss-match-name" />.
	</Tests>
      </aactivity>
      </f-element>
	  <audit-event/>
      </f-component>
      </section>

  </sec:Security_Functional_Requirements>
    <bibliography>
      <cc-entry/>
    </bibliography>
</Package>
